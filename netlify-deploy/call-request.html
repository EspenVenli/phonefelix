<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request a Call with Arthur</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        input[type="tel"], input[type="text"], input[type="email"], input[type="date"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        .radio-option {
            display: flex;
            align-items: center;
        }
        .radio-option input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        .travel-details {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 20px;
            margin-top: 15px;
            display: none;
            transition: all 0.3s ease;
        }
        .travel-details.show {
            display: block;
        }
        .travel-details h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #495057;
        }
        .date-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .airport-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: inline-block;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .loading {
            display: none;
            margin-left: 10px;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .call-details {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            display: none;
        }
        .call-details h3 {
            margin-top: 0;
            color: #495057;
        }
        .call-details dl {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 8px;
        }
        .call-details dt {
            font-weight: bold;
            color: #6c757d;
        }
        .call-details dd {
            margin-left: 0;
        }
        .back-link {
            display: block;
            margin-top: 20px;
            color: #3498db;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .section-tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            background-color: #f8f9fa;
            cursor: pointer;
            border: 1px solid #dee2e6;
        }
        .tab.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        .tab:first-child {
            border-radius: 4px 0 0 4px;
        }
        .tab:last-child {
            border-radius: 0 4px 4px 0;
        }
    </style>
</head>
<body>
    <div class="section-tabs">
        <div class="tab active" id="requestTab">Request Call</div>
        <div class="tab" id="statusTab">Check Status</div>
    </div>
    
    <div class="container" id="requestSection">
        <h1>Request a Call with Arthur</h1>
        <p>Enter your details below and Arthur, your personal travel concierge, will call you to help plan your perfect trip!</p>
        
        <form id="callForm">
            <div class="form-group">
                <label for="phoneNumber">Your Phone Number</label>
                <input type="tel" id="phoneNumber" name="phoneNumber" placeholder="+1 (555) 555-5555" required>
                <small>Please include the country code (e.g., +1 for US)</small>
            </div>
            
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" placeholder="your.email@example.com">
                <small>Optional: We'll use this to send you your travel recommendations</small>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="sendToEmail" name="sendToEmail">
                <label for="sendToEmail">Send call results and recommendations to my email</label>
            </div>
            
            <div class="form-group">
                <label>Do you know your travel dates?</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="datesYes" name="knowDates" value="yes">
                        <label for="datesYes">Yes</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="datesNo" name="knowDates" value="no" checked>
                        <label for="datesNo">No</label>
                    </div>
                </div>
            </div>
            
            <div class="travel-details" id="travelDetails">
                <h3>Travel Details</h3>
                
                <div class="date-row">
                    <div class="form-group">
                        <label for="departureDate">Departure Date</label>
                        <input type="date" id="departureDate" name="departureDate">
                    </div>
                    <div class="form-group">
                        <label for="returnDate">Return Date</label>
                        <input type="date" id="returnDate" name="returnDate">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="destination">Destination</label>
                    <input type="text" id="destination" name="destination" placeholder="e.g., Paris, France or Tokyo, Japan">
                </div>
                
                <div class="airport-row">
                    <div class="form-group">
                        <label for="departureAirport">Departure Airport</label>
                        <input type="text" id="departureAirport" name="departureAirport" placeholder="e.g., JFK, LAX, LHR">
                    </div>
                    <div class="form-group">
                        <label for="arrivalAirport">Arrival Airport (if known)</label>
                        <input type="text" id="arrivalAirport" name="arrivalAirport" placeholder="e.g., CDG, NRT, FCO">
                    </div>
                </div>
            </div>
            
            <button type="submit" id="requestButton" class="btn">
                Request Call
                <span class="loading" id="loadingSpinner"></span>
            </button>
        </form>
        
        <div class="status" id="requestStatusMessage"></div>
        
        <div class="call-details" id="callDetails">
            <h3>Call Details</h3>
            <dl>
                <dt>Call ID:</dt>
                <dd id="callSid"></dd>
                <dt>Status:</dt>
                <dd id="callStatus"></dd>
                <dt>From:</dt>
                <dd id="callFrom"></dd>
                <dt>To:</dt>
                <dd id="callTo"></dd>
                <dt>Duration:</dt>
                <dd id="callDuration"></dd>
            </dl>
        </div>
    </div>
    
    <div class="container" id="statusSection" style="display: none;">
        <h2>Check Call Status</h2>
        <p>Enter your Call ID to check the status of your call.</p>
        
        <form id="statusForm">
            <div class="form-group">
                <label for="callSidInput">Call ID</label>
                <input type="text" id="callSidInput" name="callSidInput" placeholder="CA1234567890abcdef" required>
            </div>
            
            <button type="submit" id="checkStatusButton" class="btn">
                Check Status
                <span class="loading" id="statusLoadingSpinner"></span>
            </button>
        </form>
        
        <div class="status" id="checkStatusMessage"></div>
        
        <div class="call-details" id="statusCallDetails">
            <h3>Call Details</h3>
            <dl>
                <dt>Call ID:</dt>
                <dd id="statusCallSid"></dd>
                <dt>Status:</dt>
                <dd id="statusCallStatus"></dd>
                <dt>From:</dt>
                <dd id="statusCallFrom"></dd>
                <dt>To:</dt>
                <dd id="statusCallTo"></dd>
                <dt>Duration:</dt>
                <dd id="statusCallDuration"></dd>
                <dt>Start Time:</dt>
                <dd id="statusCallStartTime"></dd>
                <dt>End Time:</dt>
                <dd id="statusCallEndTime"></dd>
            </dl>
        </div>
    </div>
    
    <a href="/" class="back-link">← Back to Home</a>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching
            const requestTab = document.getElementById('requestTab');
            const statusTab = document.getElementById('statusTab');
            const requestSection = document.getElementById('requestSection');
            const statusSection = document.getElementById('statusSection');
            
            requestTab.addEventListener('click', function() {
                requestTab.classList.add('active');
                statusTab.classList.remove('active');
                requestSection.style.display = 'block';
                statusSection.style.display = 'none';
            });
            
            statusTab.addEventListener('click', function() {
                statusTab.classList.add('active');
                requestTab.classList.remove('active');
                statusSection.style.display = 'block';
                requestSection.style.display = 'none';
            });
            
            // Travel dates toggle
            const datesYes = document.getElementById('datesYes');
            const datesNo = document.getElementById('datesNo');
            const travelDetails = document.getElementById('travelDetails');
            
            datesYes.addEventListener('change', function() {
                if (this.checked) {
                    travelDetails.classList.add('show');
                }
            });
            
            datesNo.addEventListener('change', function() {
                if (this.checked) {
                    travelDetails.classList.remove('show');
                }
            });
            
            // Email checkbox validation
            const emailInput = document.getElementById('email');
            const sendToEmailCheckbox = document.getElementById('sendToEmail');
            
            sendToEmailCheckbox.addEventListener('change', function() {
                if (this.checked && !emailInput.value) {
                    emailInput.focus();
                    alert('Please enter your email address to receive results.');
                    this.checked = false;
                }
            });
            
            emailInput.addEventListener('input', function() {
                if (!this.value) {
                    sendToEmailCheckbox.checked = false;
                }
            });
            
            // Call Request Form
            const callForm = document.getElementById('callForm');
            const requestButton = document.getElementById('requestButton');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const requestStatusMessage = document.getElementById('requestStatusMessage');
            const callDetails = document.getElementById('callDetails');
            
            callForm.addEventListener('submit', function(event) {
                event.preventDefault();
                
                // Get form data
                const phoneNumber = document.getElementById('phoneNumber').value.trim();
                const email = document.getElementById('email').value.trim();
                const sendToEmail = document.getElementById('sendToEmail').checked;
                const knowDates = document.querySelector('input[name="knowDates"]:checked').value;
                
                // Basic validation
                if (!phoneNumber) {
                    showRequestStatus('Please enter a valid phone number', 'error');
                    return;
                }
                
                if (sendToEmail && !email) {
                    showRequestStatus('Please enter an email address to receive results', 'error');
                    return;
                }
                
                // Prepare request data
                const requestData = {
                    phoneNumber: phoneNumber,
                    email: email,
                    sendToEmail: sendToEmail,
                    knowDates: knowDates
                };
                
                // Add travel details if dates are known
                if (knowDates === 'yes') {
                    requestData.travelDetails = {
                        departureDate: document.getElementById('departureDate').value,
                        returnDate: document.getElementById('returnDate').value,
                        destination: document.getElementById('destination').value,
                        departureAirport: document.getElementById('departureAirport').value,
                        arrivalAirport: document.getElementById('arrivalAirport').value
                    };
                }
                
                // Disable button and show loading state
                requestButton.disabled = true;
                loadingSpinner.style.display = 'inline-block';
                showRequestStatus('Requesting call...', 'info');
                
                // Send the request to the server
                fetch('/api/make-call', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData),
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        showRequestStatus(`Success! Arthur will call you shortly.`, 'success');
                        
                        // Store the call SID
                        document.getElementById('callSid').textContent = data.callSid;
                        callDetails.style.display = 'block';
                    } else {
                        showRequestStatus(data.message || 'Failed to initiate call', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showRequestStatus('There was an error processing your request. Please try again later.', 'error');
                })
                .finally(() => {
                    // Re-enable button and hide loading state
                    requestButton.disabled = false;
                    loadingSpinner.style.display = 'none';
                });
            });
            
            function showRequestStatus(message, type) {
                requestStatusMessage.textContent = message;
                requestStatusMessage.style.display = 'block';
                
                // Remove existing classes
                requestStatusMessage.classList.remove('success', 'error', 'info');
                
                // Add appropriate class
                if (type === 'success') {
                    requestStatusMessage.classList.add('success');
                } else if (type === 'error') {
                    requestStatusMessage.classList.add('error');
                } else if (type === 'info') {
                    requestStatusMessage.classList.add('info');
                }
            }
            
            function updateCallDetails(data) {
                document.getElementById('callStatus').textContent = data.status || 'Unknown';
                document.getElementById('callFrom').textContent = data.from || 'Unknown';
                document.getElementById('callTo').textContent = data.to || 'Unknown';
                document.getElementById('callDuration').textContent = data.duration ? `${data.duration} seconds` : 'N/A';
            }
            
            // Status Check Form
            const statusForm = document.getElementById('statusForm');
            const checkStatusButton = document.getElementById('checkStatusButton');
            const statusLoadingSpinner = document.getElementById('statusLoadingSpinner');
            const checkStatusMessage = document.getElementById('checkStatusMessage');
            const statusCallDetails = document.getElementById('statusCallDetails');
            
            statusForm.addEventListener('submit', function(event) {
                event.preventDefault();
                
                // Get the call SID
                const callSid = document.getElementById('callSidInput').value.trim();
                
                // Basic validation
                if (!callSid) {
                    showCheckStatus('Please enter a valid Call ID', 'error');
                    return;
                }
                
                // Disable button and show loading state
                checkStatusButton.disabled = true;
                statusLoadingSpinner.style.display = 'inline-block';
                showCheckStatus('Checking call status...', 'info');
                
                // Fetch the call status
                fetchCallStatus(callSid)
                    .then(data => {
                        if (data) {
                            showCheckStatus(`Call status: ${data.status}`, 'success');
                            updateStatusCallDetails(data);
                            statusCallDetails.style.display = 'block';
                        } else {
                            showCheckStatus('Call not found', 'error');
                            statusCallDetails.style.display = 'none';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showCheckStatus('There was an error checking the call status. Please try again later.', 'error');
                        statusCallDetails.style.display = 'none';
                    })
                    .finally(() => {
                        // Re-enable button and hide loading state
                        checkStatusButton.disabled = false;
                        statusLoadingSpinner.style.display = 'none';
                    });
            });
            
            function showCheckStatus(message, type) {
                checkStatusMessage.textContent = message;
                checkStatusMessage.style.display = 'block';
                
                // Remove existing classes
                checkStatusMessage.classList.remove('success', 'error', 'info');
                
                // Add appropriate class
                if (type === 'success') {
                    checkStatusMessage.classList.add('success');
                } else if (type === 'error') {
                    checkStatusMessage.classList.add('error');
                } else if (type === 'info') {
                    checkStatusMessage.classList.add('info');
                }
            }
            
            function updateStatusCallDetails(data) {
                document.getElementById('statusCallSid').textContent = data.callSid || 'Unknown';
                document.getElementById('statusCallStatus').textContent = data.status || 'Unknown';
                document.getElementById('statusCallFrom').textContent = data.from || 'Unknown';
                document.getElementById('statusCallTo').textContent = data.to || 'Unknown';
                document.getElementById('statusCallDuration').textContent = data.duration ? `${data.duration} seconds` : 'N/A';
                document.getElementById('statusCallStartTime').textContent = formatDate(data.startTime) || 'N/A';
                document.getElementById('statusCallEndTime').textContent = formatDate(data.endTime) || 'N/A';
            }
            
            function fetchCallStatus(callSid) {
                return fetch(`/status/${callSid}`)
                    .then(response => {
                        if (!response.ok) {
                            if (response.status === 404) {
                                return null; // Call not found
                            }
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    });
            }
            
            function formatDate(dateString) {
                if (!dateString) return null;
                
                const date = new Date(dateString);
                return date.toLocaleString();
            }
        });
    </script>
</body>
</html> 